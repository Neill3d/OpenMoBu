
/////////////////////////////////////////////////////////////////////////////////////////
//
// Licensed under the "New" BSD License. 
//		License page - https://github.com/Neill3d/MoBu/blob/master/LICENSE
//
// GitHub repository - https://github.com/Neill3d/MoBu
//
// Author Sergey Solokhin (Neill3d) 2014-2017
//  e-mail to: s@neill3d.com
//		www.neill3d.com
/////////////////////////////////////////////////////////////////////////////////////////


// recomputer normals in real-time (for a good quality deformations) 
// 1 - zero vertex normals before we proceed with vertex-face accumulation

#version 430

layout (local_size_x = 1024, local_size_y = 1) in;

uniform int		numberOfNormals;

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// TYPES AND DATA BUFFERS
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// output buffer
layout (std140, binding = 2) buffer OutputNormals
{
	vec4	normals[];
} outputNormals;


////////////////////////////////////////////////////////
//

uint get_invocation()
{
   uint work_group = gl_GlobalInvocationID.y * (gl_NumWorkGroups.x * gl_WorkGroupSize.x) + gl_GlobalInvocationID.x;
   return work_group;
}


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void main()
{
	// id in the array
	uint flattened_id = get_invocation();
	
	// ?! skip unused part of the array
	if (flattened_id >= numberOfNormals)
		return;
	
	outputNormals.normals[flattened_id] = vec4(0.0, 0.0, 0.0, 0.0);
}